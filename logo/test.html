<html>
<head>
<meta charset="utf-8">
<script>
var imgArr = {};
function loadImages()
{
  var srcArr = ["bee.jpg","cow.jpg","eglantine.jpg","horse.jpg","mouse.jpg","rope.jpg",
    "wall.jpg","cat.jpg","dog.jpg","Fish.jpg","moon.jpg","pencil.jpg","shoes.jpg",
    "cheese.jpg","egg.jpg","flower.jpg","mount.jpg","pictire.jpg","table.jpg"];
  var txtArr = ["Մեղու", "Կով", "Մասուր", "Ձի", "Մուկ", "Պարան",
    "Պատ", "Կատու", "Շուն", "Ձուկ", "Լուսին", "Մատիտ", "Կոշիկ",
    "Պանիր", "Ձու", "Ծաղիկ", "Սար", "Նկար", "Սեղան"
  ];
  for(var idx in srcArr)
  {
    imgArr[idx] = new Image();
    imgArr[idx].src = "img/"+srcArr[idx];
    imgArr[idx].txt = txtArr[idx];
  }
  imgArr.count = srcArr.length;
}

function selectRandomPic()
{
  imgArr.currImg = imgArr[Math.floor(Math.random() * 1000) % imgArr.count];
  var tmp = {}
  var arr = [];
  var cnt = 1;
  tmp[imgArr.currImg.txt] = "";
  arr[0] = imgArr.currImg.txt;
  while(cnt < 3)
  {
    var txt = imgArr[Math.floor(Math.random() * 1000) % imgArr.count].txt;
    if(tmp[txt] != null) continue;
    tmp[txt] = "";
    arr[cnt] = txt;
    cnt ++;
  }
  for(var i = 0; i < 32; i ++)
  {
    var i1 = Math.floor(Math.random() * 1000) % arr.length;
    var i2 = Math.floor(Math.random() * 1000) % arr.length;
    var tmp = arr[i1];
    arr[i1] = arr[i2];
    arr[i2] = tmp;
  }
  imgArr.currTxtArr = arr;
}

function draw()
{
  var ctx=cs.getContext("2d");

  // Create gradient
  var grd=ctx.createLinearGradient(0,0,cs.width,cs.height);
  grd.addColorStop(0,"red");
  grd.addColorStop(1,"yellow");

  // Fill with gradient
  ctx.fillStyle=grd;
  ctx.fillRect(0,0,cs.width,cs.height);
  var img = imgArr.currImg;
  var txtWidth = 0;
  var lineHeight = img.height / 3 - 10;
  ctx.font = lineHeight + 'pt Calibri';

  for(i in imgArr.currTxtArr) txtWidth += ctx.measureText(imgArr.currTxtArr[i]).width;
  var x = cs.width / 2 - (img.width + txtWidth) / 2;
  var y = cs.height / 2 - img.height / 2;
  imgArr.imgLeft = x;
  imgArr.imgTop = y;
  ctx.drawImage(img, x, y);
  x += img.width;
//  y += img.height / 2 - lineHeight * imgArr.currTxtArr.length / 2;
  y += lineHeight;
  ctx.save();
  ctx.fillStyle = 'blue';
  ctx.shadowColor = 'grey';
  ctx.shadowOffsetX = 10;
  ctx.shadowOffsetY = 10;
  ctx.shadowBlur = 10;
  imgArr.txtGrid = [];
  for(i in imgArr.currTxtArr)
  {
    var txt = imgArr.currTxtArr[i];
    ctx.fillText(txt, x, y);
    w = ctx.measureText(txt).width;
    imgArr.txtGrid[i] = {"x":x,"y":y,"w":w};
    x += w;
    y += (lineHeight + 10);
  }
  ctx.restore();
}

window.onload = function()
{
  cs.width = cs.parentNode.clientWidth - 30;
  cs.height = cs.parentNode.clientHeight - 30;
  loadImages();
  selectRandomPic();
  draw();
}

window.onresize = function()
{
  cs.width = cs.parentNode.clientWidth - 30;
  cs.height = cs.parentNode.clientHeight - 30;
  draw();
}

onClick = function()
{
  if(event.offsetX < imgArr.imgLeft) return;
  if(event.offsetY < imgArr.imgTop) return;
  if(event.offsetY > imgArr.imgTop + imgArr.currImg.height) return;
  if(event.offsetX < imgArr.txtGrid[0].x)
  {
    //in image
    selectRandomPic();
    draw();
    return;
  }
  if(event.offsetX < imgArr.txtGrid[1].x)
  {
    //text 0
    alert(imgArr.currTxtArr[0]);
    return;
  }
  if(event.offsetX < imgArr.txtGrid[2].x)
  {
    //text 1
    alert(imgArr.currTxtArr[1]);
    return;
  }
  //text 2
  alert(imgArr.currTxtArr[2]);
  
  /*
  if((event.offsetX < imgArr.imgLeft + imgArr.currImg.width) && (event.offsetY < imgArr.imgTop + imgArr.currImg.height))
  {
    alert("image "+event.offsetX+" "+event.offsetY + " " + imgArr.txtGrid[0].x);
  }*/
}

</script>
<head>

<body>
<canvas id="cs" style="border:1px solid #000000" onclick="onClick();">
Ձեր ծրագիրը շատ հին է, օգտագործեք Google Crome կամ Mozila Firefox
</canvas>
</body>
</html>
