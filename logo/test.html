<html>
<head>
<meta charset="utf-8">
<script>
var imgArr = [];

function libShuffle(arr, count)
{
  for(var i = 0; i < count; i ++)
  {
    var i1 = Math.floor(Math.random() * 10000) % arr.length;
    var i2 = Math.floor(Math.random() * 10000) % arr.length;
    var tmp = arr[i1];
    arr[i1] = arr[i2];
    arr[i2] = tmp;
  }
}

function libBackGround(clr0, clr1)
{
  // Create gradient
  var grd = imgArr.ctx.createLinearGradient(0,0,cs.width,cs.height);
  grd.addColorStop(0, clr0);
  grd.addColorStop(1, clr1);

  // Fill with gradient
  imgArr.ctx.fillStyle = grd;
  imgArr.ctx.fillRect(0, 0, cs.width, cs.height);
}

function randPic1(update)
{
  if(update)
  {
    imgArr.currImg = imgArr[Math.floor(Math.random() * 10000) % imgArr.length];
    imgArr.txt = "";
    var tmp = [];
    var arr = [];
    var txt = imgArr.currImg.txt;
    for(var i = 0; i < txt.length; i ++)
    {
      var ch = txt.charAt(i);
      if(ch == "ո" && txt.charAt(i + 1) == "ւ") {ch = "ու"; i ++;}
      else if(ch == "Ո" && txt.charAt(i + 1) == "Ւ") {ch = "ՈՒ"; i ++;}
      if(ch === ch.toUpperCase())
      {
        if(tmp[ch.toLowerCase()] == null)
        {
          tmp[ch.toLowerCase()] = "";
          arr.push(ch.toLowerCase());
        }
      }
      if(tmp[ch] != null) continue;
      tmp[ch] = "";
      arr.push(ch);
    }
    var count = arr.length * 2;
    if(count < 7) count = 7;
    var abc = ["ա","բ","գ","դ","ե","զ","է","ը","թ","ժ","ի","լ","խ","ծ","կ","հ","ձ","ղ","ճ","մ","յ","ն","շ","ո","չ","պ","ջ","ռ","ս","վ","տ","ր","ց","ու","փ","ք","և","օ","ֆ"];
    var i = arr.length;
    while(i < count)
    {
      var ch = abc[Math.floor(Math.random() * 10000) % abc.length];
      if(tmp[ch] != null) continue;
      tmp[ch] = "";
      arr.push(ch);
      i ++;
    }
    libShuffle(arr, arr.length * 32);
    imgArr.currTxtArr = arr;
  }
  imgArr.draw = function()
  {
    imgArr.ctx.save();
    libBackGround("red", "yellow");
    var img = imgArr.currImg;
    var txtWidth = 0;
    var lineHeight = img.height / 5;
    imgArr.ctx.font = lineHeight + 'pt Calibri';
    var x = cs.width / 2 - img.width / 2;
    var y = lineHeight;
    imgArr.imgLeft = x;
    imgArr.imgTop = y;
    imgArr.ctx.drawImage(img, x, y);
    y += img.height;
    y += lineHeight;
    y += lineHeight;
    imgArr.ctx.fillStyle = 'darkblue';
    x = cs.width / 2 - imgArr.ctx.measureText(imgArr.txt).width / 2;
    imgArr.ctx.fillText(imgArr.txt, x, y);
    lineHeight = cs.width / imgArr.currTxtArr.length / 2;
    imgArr.ctx.font = lineHeight + 'pt Calibri';
    y = cs.height - 50;
    x = 0;
    for(var i = 0; i < imgArr.currTxtArr.length; i ++)
    {
      imgArr.ctx.fillText(imgArr.currTxtArr[i], x + lineHeight - imgArr.ctx.measureText(imgArr.currTxtArr[i]).width / 2, y);
      x += 2 * lineHeight;
    }
    imgArr.ctx.restore();
  }
  imgArr.onClick = function(e)
  {
    var rc = cs.getBoundingClientRect();
    var x = e.clientX - rc.left;
    var y = e.clientY - rc.top;
    if(y < imgArr.imgTop + imgArr.currImg.height) {return randPic1(true);}
    var lineHeight = cs.width / imgArr.currTxtArr.length / 2;
    if(y < cs.height - 100 - lineHeight) return;
    var ch = imgArr.currTxtArr[Math.floor(x / (2 * lineHeight))];
    imgArr.txt += ch;
    if(imgArr.txt === imgArr.currImg.txt) return yesPic(randPic1);
    if(imgArr.currImg.txt.indexOf(imgArr.txt) != 0) {imgArr.txt = ""; return noPic(randPic1);}
    imgArr.draw();
  }
  imgArr.draw();
}

function randPic0(update)
{
  if(update)
  {
    imgArr.currImg = imgArr[Math.floor(Math.random() * 10000) % imgArr.length];
    var tmp = [];
    var arr = [];
    var cnt = 1;
    tmp[imgArr.currImg.txt] = "";
    arr.push(imgArr.currImg.txt);
    while(cnt < 3)
    {
      var txt = imgArr[Math.floor(Math.random() * 10000) % imgArr.length].txt;
      if(tmp[txt] != null) continue;
      tmp[txt] = "";
      arr.push(txt);
      cnt ++;
    }
    libShuffle(arr, 32);
    imgArr.currTxtArr = arr;
  }
  imgArr.draw = function()
  {
    imgArr.ctx.save();
    libBackGround("red", "yellow");
    var img = imgArr.currImg;
    var txtWidth = 0;
    var lineHeight = img.height / 3 - 10;
    imgArr.ctx.font = lineHeight + 'pt Calibri';

    for(i in imgArr.currTxtArr) txtWidth += imgArr.ctx.measureText(imgArr.currTxtArr[i]).width;
    if(txtWidth > cs.width - img.width)
    {
      lineHeight *= (cs.width - img.width);
      lineHeight /= txtWidth;
      imgArr.ctx.font = lineHeight + 'pt Calibri';
      txtWidth = 0;
      for(i in imgArr.currTxtArr) txtWidth += imgArr.ctx.measureText(imgArr.currTxtArr[i]).width;
    }
    var x = cs.width / 2 - (img.width + txtWidth) / 2;
    var y = cs.height / 2 - img.height / 2;
    imgArr.imgLeft = x;
    imgArr.imgTop = y;
    imgArr.ctx.drawImage(img, x, y);
    x += img.width;
    y += lineHeight;
    imgArr.ctx.fillStyle = 'darkblue';
//    imgArr.ctx.shadowColor = 'grey';
//    imgArr.ctx.shadowOffsetX = 10;
//    imgArr.ctx.shadowOffsetY = 10;
//    imgArr.ctx.shadowBlur = 10;
    imgArr.txtGrid = [];
    for(i in imgArr.currTxtArr)
    {
      var txt = imgArr.currTxtArr[i];
      imgArr.ctx.fillText(txt, x, y);
      w = imgArr.ctx.measureText(txt).width;
      imgArr.txtGrid[i] = {"x":x,"y":y,"w":w};
      x += w;
      y += (lineHeight + 10);
    }
    imgArr.ctx.restore();
  }
  imgArr.onClick = function(e)
  {
    var rc = cs.getBoundingClientRect();
    var x = e.clientX - rc.left;
    var y = e.clientY - rc.top;
    if(x < imgArr.imgLeft) return;
    if(y < imgArr.imgTop) return;
    if(y > imgArr.imgTop + imgArr.currImg.height) return;
    if(x < imgArr.txtGrid[0].x)
    {
      randPic0(true);
      imgArr.draw();
      return;
    }
    //in text
    var selTxt = "";
    if(x < imgArr.txtGrid[1].x) selTxt = imgArr.currTxtArr[0];
    else if(x < imgArr.txtGrid[2].x) selTxt = imgArr.currTxtArr[1];
    else selTxt = imgArr.currTxtArr[2];
    selTxt == imgArr.currImg.txt ? yesPic(randPic0) : noPic(randPic0);
  }
  imgArr.draw();
}

function yesPic(retFunc)
{
  imgArr.draw = function()
  {
    imgArr.ctx.save();
    libBackGround("red", "yellow");
    var img = imgArr.currImg;
    var lineHeight = 20;
    imgArr.ctx.font = lineHeight + 'pt Calibri';
    var txtWidth = imgArr.ctx.measureText(img.txt).width;
    lineHeight *= img.width;
    lineHeight /= txtWidth;
    imgArr.ctx.font = lineHeight + 'pt Calibri';
    var x = cs.width / 2 - img.width / 2;
    var y = cs.height / 2 - img.height / 2;
    imgArr.ctx.drawImage(img, x, y);
    imgArr.ctx.fillStyle = 'darkblue';
    imgArr.ctx.fillText(img.txt, x, y + img.height + lineHeight + 10);
    imgArr.ctx.restore();
  }
  imgArr.onClick = function(e) {retFunc(true);}
  imgArr.draw();
}

function noPic(retFunc)
{
  imgArr.draw = function()
  {
    imgArr.ctx.save();
    libBackGround("red", "yellow");
    var img = imgArr.currImg;
    var x = cs.width / 2 - img.width / 2;
    var y = cs.height / 2 - img.height / 2;
    imgArr.ctx.drawImage(img, x, y);
    var img = imgArr.no;
    var x = cs.width / 2 - img.width / 2;
    var y = cs.height / 2 - img.height / 2;
    imgArr.ctx.drawImage(img, x, y);
    imgArr.ctx.restore();
  }
  imgArr.onClick = function(e) {retFunc(false);}
  imgArr.draw();
}

function loadingImages()
{
  imgArr.draw = function()
  {
    imgArr.ctx.save();
    libBackGround("green", "yellow");
    imgArr.ctx.font = 20 + 'pt Calibri';
    var txt = "Նկարները բեռնվում են․․․";
    var txtWidth = imgArr.ctx.measureText(txt).width;
    var x = cs.width / 2 - txtWidth / 2;
    var y = cs.height / 2;
    imgArr.ctx.fillStyle = 'darkblue';
    imgArr.ctx.fillText(txt, x, y);
    imgArr.ctx.restore();
  }
  imgArr.draw();
}

function test0() {randPic0(true);}
function test1() {randPic1(true);}

window.onload = function()
{
  cs.width = cs.parentNode.clientWidth - 30;
  cs.height = cs.parentNode.clientHeight - 30;
  imgArr.ctx = cs.getContext("2d");
  loadingImages();
  var srcArr = ["apple.jpg","apricot.jpg","banana.jpg","bee.jpg","book.jpg","cake.jpg","cap.jpg", "car.jpg","cat.jpg",  "chear.jpg","cheese.jpg","cloud.jpg","cow.jpg","dog.jpg","duck.jpg","egg.jpg","eglantine.jpg","elephant.jpg","Fish.jpg","flower.jpg","fox.jpg","fruits.jpg","goat.jpg","God's kow.jpg","guitar.jpg","hammer.jpg","horse.jpg","ice-cream.jpg","lamp.jpg","lemo.jpg","medicine.jpg","moon.jpg","mount.jpg","mouse.jpg","peach.jpg","pear.jpg","pencil.jpg","pictire.jpg","pig.jpg","rope.jpg","sheep.jpg","ship.jpg","shoes.jpg","strawberries.jpg","table.jpg","tea.jpg","tree.jpg","t-shirt.jpg","violin.jpg","wall.jpg","wolf.jpg"];
  var txtArr = ["Խնձոր",  "Ծիրան",    "Բանան",  "Մեղու", "Գիրք",   "Տորթ",   "Գլխարկ","Մեքենա","Կատու","Աթոռ",    "Պանիր",   "Ամպ",    "Կով",   "Շուն",  "Բադ",    "Ձու",    "Մասուր",     "Փիղ",        "Ձուկ",   "Ծաղիկ",   "Աղվես","Միրգ",     "Այծ",     "Զատիկ",     "Կիթառ",   "Մուրճ",    "Ձի",      "Պաղպաղակ","Լամպ",  "Կիտրոն","Դեղ",        "Լուսին", "Սար",     "Մուկ",    "Դեղձ",    "Տանձ",  "Մատիտ",  "Նկար",     "Խոզ",   "Պարան","Ոչխար",  "Նավ",   "Կոշիկ",   "Ելակ",           "Սեղան",  "Թեյ",   "Ծառ",    "Շապիկ",   "Ջութակ",  "Պատ",   "Գայլ"];
  if(srcArr.length != txtArr.length)
    alert("ՍԽԱԼ՝ նկարների և անունների քանակները տարբեր են․ " + srcArr.length + " " + txtArr.length);
  imgArr.no = new Image();
  imgArr.no.src = "img/no-small.png";
  for(var idx in srcArr)
  {
    var img = new Image();
    img.txt = txtArr[idx];
    img.src = "img/"+srcArr[idx];
    img.onload = function(e)
    {
      imgArr.push(e.target);
      if(imgArr.length == txtArr.length) {window.onhashchange();}
    }
  }
  cs.addEventListener("click", function(e) {imgArr.onClick(e);})
}

window.onhashchange = function()
{
  var entryPoint = document.URL.split("#")[1];
  if(entryPoint == undefined) entryPoint = "randPic0(true);";
  try{eval(entryPoint);}catch(e){test0();}
}

window.onresize = function()
{
  cs.width = cs.parentNode.clientWidth - 30;
  cs.height = cs.parentNode.clientHeight - 30;
  imgArr.draw();
}

</script>
<head>

<body>
<canvas id="cs" style="border:1px solid #000000"">
Ձեր ծրագիրը շատ հին է, օգտագործեք Google Crome կամ Mozila Firefox
</canvas>
</body>
</html>

