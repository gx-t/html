<!DOCTYPE html>
<html manifest='geo-test.appcache'>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>Geo Test</title>
</head>
<body >
<p id="info"></p>
<hr>
<p id="save"></p>
<p><h2><a href='javascript:clear();'>Ջնջել Հիշվածը</a></h2></p>
<hr>
<p id="gmaps"></p>
<script>

g_position = null;
g_timestamp = new Date();

function clear() {
	if(confirm("Բոլոր հիշված դիրքերը կմոռացվեն։ Շարունակե՞լ")) {
		localStorage.positionArray = "[]";
		alert("Բոլոր հիշված դիրքերը ջնջված են");
	}
}

function save() {
	if(localStorage.positionArray == undefined) localStorage.positionArray = "[]";
	var arr = JSON.parse(localStorage.positionArray);
	arr.push(g_position);
	localStorage.positionArray = JSON.stringify(arr);
	document.getElementById("save").innerHTML = "<h2>Հիշված է</h2>";
}

window.onload=function() {
	if (navigator.geolocation) {
		document.getElementById("info").innerHTML = "<h2>Տվյալները դեռ հասանելի չեն...</h2>";
		navigator.geolocation.watchPosition(
			function(position) {
				g_position = position;
				g_timestamp.setTime(position.timestamp);
   				document.getElementById("info").innerHTML =
	   				"<h2><table><tr><td>Լայնությունը`</td><td>" + position.coords.latitude +
					"</td></tr><tr><td>Երկայնությունը`</td><td>" + position.coords.longitude +
					"</td></tr><tr><td>Բարձրությունը`</td><td>" + position.coords.altitude +
					"</td></tr><tr><td>Ճշգրտությունը`</td><td>" + position.coords.accuracy +
					"</td></tr><tr><td>Բարձ․ Ճշգրտությունը`</td><td>" + position.coords.altitudeAccuracy +
					"</td></tr><tr><td>Շարժ․ Ուղղությունը`</td><td>" + position.coords.heading +
					"</td></tr><tr><td>Արագությունը (մ/վ)`</td><td>" + position.coords.speed +
					"</td></tr><tr><td colspan=\"2\"><hr></td></tr><tr><td colspan=\"2\">" +
					g_timestamp.toString() + "</td></tr></table></h2>";
				document.getElementById("save").innerHTML = "<h2><a href=\'javascript:save();\'>Հիշել</a></h2>";
				document.getElementById("gmaps").innerHTML = "<a href=http://maps.google.com/maps?q=" +
				position.coords.latitude + "," +
				position.coords.longitude +
				">Google Maps -ով բացել</a>";
			},
			function(error) {
				var err = "An unknown error occurred.";
				switch(error.code) {
					case error.PERMISSION_DENIED:
						err = "User denied the request for Geolocation."
						break;
					case error.POSITION_UNAVAILABLE:
						err = "Location information is unavailable."
						break;
					case error.TIMEOUT:
						err = "The request to get user location timed out."
						break;
				}
				document.getElementById("info").innerHTML = err;
			},
			{ enableHighAccuracy: true }
		);
	} else { 
		document.getElementById("info").innerHTML = "<h2>Դիրքի հայտնաբերումը ձեր ծրագրով անհնար է։</h2>";
	}
};


</script>

</body>
</html>

